# Como instalar e usar o Docker no Linux

Instale o pacote docker-ce (Community Edition). Várias distribuições já vem com o Docker disponível para instalar em seus respectivos repositórios, mas costuma não ser a versão mais atualizada. A equipe do Docker tem repositórios atualizados para as principais distribuições. Dê preferência para a versão mais atualizada.

**Debian**: Comandos para adicionar o repositório e instalar o Docker.
```
$ sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common
$ curl -fsSL https://download.docker.com/linux/$(. /etc/os-release; echo "$ID")/gpg | sudo apt-key add -
```
Você vai receber uma sequência hexadecimal (ex: 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C **0EBF CD88**). Pegue os últimos 8 caracteres e use no comando abaixo:
```
$ sudo apt-key fingerprint 0EBFCD88
$ sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/$(. /etc/os-release; echo "$ID") $(lsb_release -cs) stable"
$ sudo apt-get install docker-ce
```

**CentOS**: Comandos para adicionar o repositório e instalar o Docker:
```
$ sudo yum install -y yum-utils device-mapper-persistent-data lvm2
$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
$ sudo yum install docker-ce
```  

Crie o grupo docker, caso não exista:

```
$ sudo groupadd docker
```

Adicione o seu usuário ao grupo docker para que você possa rodar o docker usando o seu próprio usuário, e não como root:

```
$ sudo usermod -aG docker seu_usuario
```

Inicie o daemon do docker coloque-o para inicializar no boot (pode variar de uma distribuição pra outra):

```
$ sudo systemctl restart docker
$ sudo systemctl enable docker
```

Para testar, logue com o seu usuário e coloque o container exemplo para rodar:
```
$ docker run hello-world
```

Pare o container usando CTRL-C

## Criando uma aplicação PHP de exemplo

Crie um diretório vazio e entre nele. Crie dois arquivos:
  * Dockerfile
  * index.htm

No **Dockerfile** coloque o seguinte conteúdo:
```
FROM php
WORKDIR /app
ADD . /app
EXPOSE 80
CMD ["php", "-S", "0.0.0.0:80"]
```

No **index.htm** coloque o conteúdo HTML que quiser.

Faça o build do container:
```
$ docker build -t phpapp .
```

Rode o container:
```
$ docker run -p 4000:80 phpapp
```

Acesse a porta 4000 da máquina onde o docker está rodando para acessar a porta 80 do container, usando o seu navegador:

http://127.0.0.1:4000/index.htm

CTRL-C para terminar a execução deste container.

# Obsevações

Explicação de cada linha deste Dockerfile
```
FROM php                         | Define que a imagem a ser usada é a php do repositório do Docker.
WORKDIR /app                     | Define o diretório /app como o atual no container.
ADD . /app                       | Copia os arquivos do diretório atual do host para o diretório /app do container.
EXPOSE 80                        | Serve só para documentar que porta este container libera.
CMD ["php", "-S", "0.0.0.0:80"]  | Roda o servidor http embutido do PHP.
```

---

*keywords: docker, container, installation, install, run, linux, image, imagem, tutorial*

*references:*

*https://docs.docker.com/get-started/#setup*

*https://docs.docker.com/engine/installation/linux/linux-postinstall/#configure-docker-to-start-on-boot*

*https://docs.docker.com/engine/installation/linux/docker-ce/debian/#install-using-the-repository*

*https://docs.docker.com/engine/reference/run/*

*https://docs.docker.com/engine/installation/linux/docker-ce/centos/#install-using-the-repository*

*https://github.com/moby/moby/pull/21032*
